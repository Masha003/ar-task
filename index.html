<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AR Story Experience</title>
  
  <!-- A-Frame and AR.js -->
  <script src="https://cdn.jsdelivr.net/gh/aframevr/aframe@1c2407b26c61958baa93967b5412487cd94b290b/dist/aframe-master.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>

  <style>
    .arjs-loader {
      height: 100%;
      width: 100%;
      position: absolute;
      top: 0;
      left: 0;
      background-color: rgba(0, 0, 0, 0.8);
      z-index: 9999;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .arjs-loader div {
      text-align: center;
      font-size: 1.25em;
      color: white;
    }

    .ui-overlay {
      position: fixed;
      top: 10px;
      left: 10px;
      z-index: 1000;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 15px;
      border-radius: 10px;
      font-family: Arial, sans-serif;
      max-width: 300px;
    }

    .ui-overlay h3 {
      margin: 0 0 10px 0;
      font-size: 16px;
    }

    .ui-overlay p {
      margin: 5px 0;
      font-size: 12px;
    }

    .status {
      color: #4CAF50;
      font-weight: bold;
    }
  </style>
</head>

<body style="margin: 0px; overflow: hidden">
  
  <!-- Loading screen -->
  <div class="arjs-loader">
    <div>Loading AR Experience...<br>Please wait...</div>
  </div>

  <!-- UI Overlay for instructions -->
  <div class="ui-overlay">
    <h3>ðŸŒŸ AR Story Mode</h3>
    <p>ðŸ“· Scan the first marker to begin</p>
    <p class="status" id="status">Status: Ready</p>
    <p id="progress">Progress: 0/2 markers found</p>
  </div>

  <!-- A-Frame Scene -->
  <a-scene
    vr-mode-ui="enabled: false;"
    renderer="logarithmicDepthBuffer: true;"
    embedded
    arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;"
    gesture-detector
  >
    
    <!-- ========== FIRST MARKER: Chapter 1 ========== -->
    <a-nft
      id="marker1"
      type="nft"
      url="carnet"
      smooth="true"
      smoothCount="10"
      smoothTolerance=".01"
      smoothThreshold="5"
      registerevents
    >
      <!-- Main 3D Model -->
      <a-entity
        id="model1"
        gltf-model="https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/Fox/glTF-Binary/Fox.glb"
        scale="0.3 0.3 0.3"
        position="0 0 0"
        rotation="0 0 0"
        animation="property: rotation; to: 0 360 0; loop: true; dur: 10000; easing: linear"
        class="clickable"
      >
      </a-entity>

      <!-- Animated text above model -->
      <a-text 
        value="Chapter 1: The Beginning" 
        color="#FFD700" 
        width="8" 
        position="0 25 0"
        align="center"
        animation="property: position; to: 0 30 0; dir: alternate; loop: true; dur: 2000; easing: easeInOutSine"
      >
      </a-text>

      <!-- Description text -->
      <a-text 
        value="Click the fox to continue!" 
        color="white" 
        width="6" 
        position="0 -10 0"
        align="center"
      >
      </a-text>

      <!-- Floating particles effect -->
      <a-entity
        geometry="primitive: sphere; radius: 0.5"
        material="color: #4CAF50; opacity: 0.6; transparent: true"
        position="10 15 0"
        animation="property: position; to: -10 20 0; loop: true; dur: 3000; dir: alternate; easing: easeInOutQuad"
      >
      </a-entity>

      <a-entity
        geometry="primitive: sphere; radius: 0.5"
        material="color: #2196F3; opacity: 0.6; transparent: true"
        position="-10 18 0"
        animation="property: position; to: 10 22 0; loop: true; dur: 4000; dir: alternate; easing: easeInOutQuad"
      >
      </a-entity>
    </a-nft>

    <!-- ========== SECOND MARKER: Chapter 2 (Only appears after first is scanned) ========== -->
    <a-nft
      id="marker2"
      type="nft"
      url="inel"
      smooth="true"
      smoothCount="10"
      smoothTolerance=".01"
      smoothThreshold="5"
      visible="false"
    >
      <!-- Different 3D Model -->
      <a-entity
        id="model2"
        gltf-model="https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/Duck/glTF-Binary/Duck.glb"
        scale="15 15 15"
        position="0 0 0"
        rotation="0 45 0"
        animation="property: scale; to: 20 20 20; dir: alternate; loop: true; dur: 2000; easing: easeInOutSine"
        class="clickable"
      >
      </a-entity>

      <!-- Victory text -->
      <a-text 
        value="Chapter 2: The Journey Continues!" 
        color="#FF1744" 
        width="8" 
        position="0 40 0"
        align="center"
        animation="property: rotation; to: 0 360 0; loop: true; dur: 8000; easing: linear"
      >
      </a-text>

      <a-text 
        value="You've completed the story!" 
        color="yellow" 
        width="6" 
        position="0 30 0"
        align="center"
      >
      </a-text>

      <!-- Celebration particles -->
      <a-entity
        geometry="primitive: box; width: 2; height: 2; depth: 2"
        material="color: #FFD700; opacity: 0.7; transparent: true"
        position="15 20 0"
        animation="property: rotation; to: 360 360 360; loop: true; dur: 3000; easing: linear"
      >
      </a-entity>

      <a-entity
        geometry="primitive: box; width: 2; height: 2; depth: 2"
        material="color: #FF1744; opacity: 0.7; transparent: true"
        position="-15 25 0"
        animation="property: rotation; to: 360 360 360; loop: true; dur: 2500; easing: linear"
      >
      </a-entity>
    </a-nft>

    <!-- Camera -->
    <a-entity camera look-controls="enabled: false" fov="80" near="0.1" far="1000"></a-entity>
  </a-scene>

  <!-- JavaScript for interactions -->
  <script>
    // Track which markers have been found
    let marker1Found = false;
    let marker2Found = false;
    let marker1Clicked = false;

    // Update status function
    function updateStatus(message) {
      document.getElementById('status').textContent = 'Status: ' + message;
    }

    function updateProgress() {
      let count = (marker1Found ? 1 : 0) + (marker2Found ? 1 : 0);
      document.getElementById('progress').textContent = 'Progress: ' + count + '/2 markers found';
    }

    // Wait for scene to load
    document.querySelector('a-scene').addEventListener('loaded', function() {
      console.log('Scene loaded');
      
      // Marker 1 events
      const marker1 = document.getElementById('marker1');
      
      marker1.addEventListener('markerFound', function() {
        console.log('Marker 1 found!');
        marker1Found = true;
        updateStatus('Chapter 1 discovered!');
        updateProgress();
      });

      marker1.addEventListener('markerLost', function() {
        console.log('Marker 1 lost');
        updateStatus('Searching...');
      });

      // Click interaction on first model
      const model1 = document.getElementById('model1');
      if (model1) {
        model1.addEventListener('click', function() {
          if (marker1Found && !marker1Clicked) {
            marker1Clicked = true;
            updateStatus('Chapter 1 completed! Find second marker!');
            
            // Enable second marker
            const marker2 = document.getElementById('marker2');
            marker2.setAttribute('visible', 'true');
            
            // Add notification
            alert('Great! Now scan the second marker to continue the story!');
          }
        });
      }

      // Marker 2 events (only works if marker1 was clicked)
      const marker2 = document.getElementById('marker2');
      
      marker2.addEventListener('markerFound', function() {
        if (marker1Clicked) {
          console.log('Marker 2 found!');
          marker2Found = true;
          updateStatus('Story Complete! ðŸŽ‰');
          updateProgress();
        } else {
          updateStatus('Please complete Chapter 1 first!');
        }
      });

      marker2.addEventListener('markerLost', function() {
        if (marker1Clicked) {
          updateStatus('Marker lost...');
        }
      });

      // Click interaction on second model
      const model2 = document.getElementById('model2');
      if (model2) {
        model2.addEventListener('click', function() {
          if (marker2Found) {
            alert('Congratulations! You have completed the AR Story Experience! ðŸŽ‰');
            updateStatus('All chapters completed!');
          }
        });
      }
    });

    // Register AFRAME components for gestures
    AFRAME.registerComponent('registerevents', {
      init: function () {
        const marker = this.el;
        
        marker.addEventListener('markerFound', function() {
          console.log('Marker detected');
        });

        marker.addEventListener('markerLost', function() {
          console.log('Marker lost');
        });
      }
    });
  </script>

</body>
</html>